<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Predicting</title>

<script src="Prediction_practical_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="Prediction_practical_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="Prediction_practical_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="Prediction_practical_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="Prediction_practical_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="Prediction_practical_files/navigation-1.1/tabsets.js"></script>
<link href="Prediction_practical_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="Prediction_practical_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="practical.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Predicting</h1>
<h4 class="author"><table style='table-layout:fixed;width:100%;border:0;padding:0;margin:0'>
<col width='10%'>
<col width='10%'>
<tr style="border:none">
<td style="display:block;width:100%;text-align:left;vertical-align:bottom;padding:0;margin:0;border:none" nowrap>
<font style='font-style:normal'>Maschinelles Lernen mit R</font><br> <a href='https://therbootcamp.github.io/ML_2020Apr/'> <i class='fas fa-clock' style='font-size:.9em;' ></i> </a> <a href='https://therbootcamp.github.io'> <i class='fas fa-home' style='font-size:.9em;'></i> </a> <a href='mailto:therbootcamp@gmail.com'> <i class='fas fa-envelope' style='font-size: .9em;'></i> </a> <a href='https://www.linkedin.com/company/basel-r-bootcamp/'> <i class='fab fa-linkedin' style='font-size: .9em;'></i> </a> <a href='https://therbootcamp.github.io'> <font style='font-style:normal'>The R Bootcamp</font> </a>
</td>
<td style="width:100%;vertical-align:bottom;text-align:right;padding:0;margin:0;border:none">
<img src='https://raw.githubusercontent.com/therbootcamp/therbootcamp.github.io/master/_sessions/_image/by-sa.png' style='height:15px;width:80px'/>
</td>
</tr>
</table></h4>

</div>


<p align="center">
<img width="100%" src="https://cdn-images-1.medium.com/max/1200/0*F0y1bmOEzCFCcPE_" margin=0><br> <font style="font-size:10px">from <a href="https://Medium.com/">Medium.com</a></font>
</p>
<div id="section" class="section level1 tabset">
<h1></h1>
<div id="uberblick" class="section level2">
<h2>Überblick</h2>
<p>In diesem Practical wirst modellbasierte Vorhersagen generieren und die Modelle anhand der Qualität dieser messen.</p>
<p>Am Ende des Practicals wirst du wissen wie man…</p>
<ol style="list-style-type: decimal">
<li>Regression, Decision tree, und Random forest an Trainingsdaten fitted.</li>
<li>Modelle anhand der Traningsdaten und anhand der Testdaten evaluiert und vergleicht.</li>
</ol>
</div>
<div id="aufgaben" class="section level2">
<h2>Aufgaben</h2>
<div id="a---setup" class="section level3">
<h3>A - Setup</h3>
<ol style="list-style-type: decimal">
<li><p>Öffne dein <code>TheRBootcamp</code> R project. Es sollte die Ordner <code>1_Data</code> und <code>2_Code</code> enthalten. Stelle sicher, dass du alle Datensätze, welche im <code>Datensätze</code> Tab aufgelisted sind, in deinem <code>1_Data</code> Ordner hast.</p></li>
<li><p>Öffne ein neues R Skript. Schreibe deinen Namen, das Datum und “Predicting Practical” als Kommentare an den Anfang des Skripts.</p></li>
</ol>
<pre class="r"><code>## NAME
## DATUM
## Predicting Practical</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><p>Speichere das neue Skript unter dem Namen <code>predicting_practical.R</code> im <code>2_Code</code> Ordner.</p></li>
<li><p>Lade die Pakete <code>tidyverse</code>, <code>caret</code>, <code>party</code>, <code>partykit</code>.</p></li>
</ol>
<pre class="r"><code>library(tidyverse)
library(caret)
library(party)
library(partykit)</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Definiere wie zuvor ein <code>ctrl_none</code> Objekt mit dem wir im Traning die Samplingmethode auf <code>none</code> setzen. Erst in der nächsten Session beginnen wir dies zu ändern.</li>
</ol>
<pre class="r"><code># Setze Samplingmethode auf none
ctrl_none &lt;- trainControl(method = &quot;none&quot;) </code></pre>
<br>
<p style="font-size:20px;background-color:#6ABA9A;color:white;padding-left:20px" align="left" width="100%">
Datensatz 1: <b>College Abschlussraten</b>
</p>
</div>
<div id="b---lade-die-graduation-datensatze" class="section level3">
<h3>B - Lade die <code>graduation</code> Datensätze</h3>
<ol style="list-style-type: decimal">
<li>Verwende die <code>read_csv()</code> Funktion um die Datensätze <code>graduation_train.csv</code> und <code>graduation_test.csv</code> einzulesen.</li>
</ol>
<pre class="r"><code># Lese Daten ein
graduation_train &lt;- read_csv(file = &quot;1_Data/graduation_train.csv&quot;)
graduation_test &lt;- read_csv(file = &quot;1_Data/graduation_test.csv&quot;)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><p>Printe die Datensätze.</p></li>
<li><p>Verwende <code>names(XX)</code>, <code>summary(XX)</code>, und <code>View()</code> um einen weiteren Überblick über die Daten zu bekommen.</p></li>
<li><p>Wiederum, führe den Code unten aus um sicherzustellen, dass alle <code>character</code> Features als Faktoren vorliegen.</p></li>
</ol>
<pre class="r"><code># Konvertiere alle character zu factor
graduation_train &lt;- graduation_train %&gt;%
          mutate_if(is.character, factor)

graduation_test &lt;- graduation_test %&gt;%
          mutate_if(is.character, factor)</code></pre>
</div>
<div id="c---fitting" class="section level3">
<h3>C - Fitting</h3>
<div id="regression" class="section level4">
<h4>Regression</h4>
<ol style="list-style-type: decimal">
<li>Verwende <code>train()</code> um ein Regressionsmodell namens <code>abschluss_glm</code> zu fitten, das die <code>Abschlussrate</code> als Funktion aller anderen im Datensatz enthaltenen Features vorhersagt. D.h.,…</li>
</ol>
<ul>
<li>setze das <code>form</code> Argument auf <code>Abschlussrate ~ .</code>.</li>
<li>setze das <code>data</code> Argument auf <code>graduation_train</code>.</li>
<li>setze das <code>method</code> Argument auf <code>method = &quot;glm&quot;</code>.</li>
<li>setze das <code>trControl</code> Argument auf <code>ctrl_none</code> (siehe oben).</li>
</ul>
<pre class="r"><code>abschluss_glm &lt;- train(form = XX ~ .,
                  data = XX,
                  method = &quot;XX&quot;,
                  trControl = ctrl_none)</code></pre>
<pre class="r"><code>abschluss_glm &lt;- train(form = Abschlussrate ~ .,
                  data = graduation_train,
                  method = &quot;glm&quot;,
                  trControl = ctrl_none)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Exploriere <code>abschluss_glm</code> indem du <code>abschluss_glm$finalModel</code> printest und <code>summary()</code> auf das Fit-Objekt anwendest. Wie beurteilst du die Outputs?</li>
</ol>
<pre class="r"><code>abschluss_glm$XX
summary(XX)</code></pre>
<pre class="r"><code>abschluss_glm$finalModel</code></pre>
<pre><code>
Call:  NULL

Coefficients:
           (Intercept)  PrivatuniversitaetNein             Bewerbungen  
             32.712812               -1.701840                0.001926  
            Angenommen          Eingeschrieben           Prozent_Top10  
             -0.001754                0.005550               -0.049727  
         Prozent_Top25                Vollzeit                Teilzeit  
              0.206252               -0.001069               -0.001294  
     Kosten_ausserhalb       Kosten_Unterkunft          Kosten_Buecher  
              0.001782                0.000871               -0.000932  
    Kosten_persoenlich             Prozent_PhD          Prozent_Degree  
             -0.001457                0.104743               -0.101789  
 Verhaeltnis_Stud.Doz.         Prozent_Spenden          Kosten_Student  
              0.275943                0.219944               -0.000683  

Degrees of Freedom: 499 Total (i.e. Null);  482 Residual
Null Deviance:      142000 
Residual Deviance: 74600    AIC: 3960</code></pre>
<pre class="r"><code>summary(abschluss_glm)</code></pre>
<pre><code>
Call:
NULL

Deviance Residuals: 
   Min      1Q  Median      3Q     Max  
-38.10   -7.24   -0.58    7.51   47.10  

Coefficients:
                        Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)            32.712812   5.544068    5.90  6.8e-09 ***
PrivatuniversitaetNein -1.701840   2.114677   -0.80  0.42135    
Bewerbungen             0.001926   0.000572    3.37  0.00082 ***
Angenommen             -0.001754   0.001046   -1.68  0.09417 .  
Eingeschrieben          0.005550   0.002872    1.93  0.05387 .  
Prozent_Top10          -0.049727   0.086281   -0.58  0.56466    
Prozent_Top25           0.206252   0.066972    3.08  0.00219 ** 
Vollzeit               -0.001069   0.000461   -2.32  0.02068 *  
Teilzeit               -0.001294   0.000444   -2.92  0.00369 ** 
Kosten_ausserhalb       0.001782   0.000297    6.01  3.7e-09 ***
Kosten_Unterkunft       0.000871   0.000721    1.21  0.22790    
Kosten_Buecher         -0.000932   0.004089   -0.23  0.81988    
Kosten_persoenlich     -0.001457   0.000998   -1.46  0.14494    
Prozent_PhD             0.104743   0.071027    1.47  0.14095    
Prozent_Degree         -0.101789   0.076321   -1.33  0.18293    
Verhaeltnis_Stud.Doz.   0.275943   0.191423    1.44  0.15008    
Prozent_Spenden         0.219944   0.061576    3.57  0.00039 ***
Kosten_Student         -0.000683   0.000202   -3.39  0.00077 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for gaussian family taken to be 155)

    Null deviance: 141641  on 499  degrees of freedom
Residual deviance:  74595  on 482  degrees of freedom
AIC: 3960

Number of Fisher Scoring iterations: 2</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Mittels <code>predict()</code> generiere die gefitteten Werte von <code>abschluss_glm</code> und speichere sie als <code>glm_fit</code> ab.</li>
</ol>
<pre class="r"><code># Speichere die gefitteten Werte
glm_fit &lt;- predict(XX)</code></pre>
<pre class="r"><code>glm_fit &lt;- predict(abschluss_glm)</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Printe <code>glm_fit</code> und kriere ein Histogramm der Werte mittels <code>hist()</code>. Sind die Werte in einer plausiblen Region?</li>
</ol>
<pre class="r"><code># Inspeziere die gefitteten Werte
XX
hist(XX)</code></pre>
<pre class="r"><code>glm_fit[1:10]</code></pre>
<pre><code>   1    2    3    4    5    6    7    8    9   10 
71.8 56.4 91.8 62.9 69.2 68.5 57.4 52.0 57.4 71.0 </code></pre>
<pre class="r"><code>hist(glm_fit)</code></pre>
<p><img src="Prediction_practical_files/figure-html/unnamed-chunk-13-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="decision-trees" class="section level4">
<h4>Decision Trees</h4>
<ol start="6" style="list-style-type: decimal">
<li>Verwende <code>train()</code> um einen Decision Tree namens <code>abschluss_rpart</code> zu fitten, welcher die <code>Abschlussrate</code> als Funktion aller anderen im Datensatz enthaltenen Features vorhersagt. D.h.,…</li>
</ol>
<ul>
<li>setze das <code>form</code> Argument auf <code>Abschlussrate ~ .</code>.</li>
<li>setze das <code>data</code> Argument auf <code>graduation_train</code>.</li>
<li>setze das <code>method</code> Argument auf <code>method = &quot;rpart&quot;</code>..</li>
<li>setze das <code>trControl</code> Argument auf your <code>ctrl_none</code>..</li>
<li>setze das <code>tuneGrid</code> Argument auf <code>cp = 0.01</code>.</li>
</ul>
<pre class="r"><code>abschluss_rpart &lt;- train(form = XX ~ .,
                         data = XX,
                         method = &quot;XX&quot;,
                         trControl = XX,
                         tuneGrid = expand.grid(cp = XX)) </code></pre>
<pre class="r"><code>abschluss_rpart &lt;- train(form = Abschlussrate ~ .,
                  data = graduation_train,
                  method = &quot;rpart&quot;,
                  trControl = ctrl_none,
                  tuneGrid = expand.grid(cp = .01))</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Exploriere <code>abschluss_rpart</code> indem du <code>abschluss_rpart$finalModel</code> printest und mit <code>plot(as.party(abschluss_rpart$finalModel))</code> den Decision Tree plottest. Wie beurteilst du die Outputs?</li>
</ol>
<pre class="r"><code>abschluss_rpart$finalModel</code></pre>
<pre><code>n= 500 

node), split, n, deviance, yval
      * denotes terminal node

 1) root 500 142000 65.6  
   2) Kosten_ausserhalb&lt; 1.06e+04 292  69000 58.0  
     4) Prozent_Top25&lt; 47.5 135  34100 53.3  
       8) Kosten_ausserhalb&lt; 8.56e+03 86  20000 48.9  
        16) Kosten_Student&gt;=6.97e+03 26   6430 41.9 *
        17) Kosten_Student&lt; 6.97e+03 60  11700 52.0  
          34) Kosten_Buecher&gt;=388 53   9310 50.0 *
          35) Kosten_Buecher&lt; 388 7    639 66.7 *
       9) Kosten_ausserhalb&gt;=8.56e+03 49   9520 61.1 *
     5) Prozent_Top25&gt;=47.5 157  29600 61.9  
      10) Prozent_Top10&lt; 51.5 147  26100 61.0  
        20) Prozent_Spenden&lt; 24.5 110  16700 58.9 *
        21) Prozent_Spenden&gt;=24.5 37   7500 67.2 *
      11) Prozent_Top10&gt;=51.5 10   1570 75.3 *
   3) Kosten_ausserhalb&gt;=1.06e+04 208  31500 76.4  
     6) Kosten_ausserhalb&lt; 1.68e+04 158  21500 73.3  
      12) Prozent_Spenden&lt; 22.5 55   8180 68.7 *
      13) Prozent_Spenden&gt;=22.5 103  11500 75.8  
        26) Vollzeit&lt; 1.42e+03 55   4770 71.2 *
        27) Vollzeit&gt;=1.42e+03 48   4200 81.1 *
     7) Kosten_ausserhalb&gt;=1.68e+04 50   4040 85.9 *</code></pre>
<pre class="r"><code>plot(as.party(abschluss_rpart$finalModel))</code></pre>
<p><img src="Prediction_practical_files/figure-html/unnamed-chunk-16-1.png" width="576" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>Mittels <code>predict()</code> generiere die gefitteten Werte von <code>abschluss_rpart</code> und speichere sie als <code>rpart_fit</code> ab.</li>
</ol>
<pre class="r"><code># Speichere die gefitteten Werte
rpart_fit &lt;- predict(XX)</code></pre>
<pre class="r"><code>rpart_fit &lt;- predict(abschluss_rpart)</code></pre>
<ol start="9" style="list-style-type: decimal">
<li>Printe <code>rpart_fit</code> und kriere ein Histogramm der Werte mittels <code>hist()</code>. Sind die Werte in einer plausiblen Region?</li>
</ol>
<pre class="r"><code># Inspeziere die gefitteten Werte
XX
hist(XX)</code></pre>
<pre class="r"><code>rpart_fit[1:10]</code></pre>
<pre><code>   1    2    3    4    5    6    7    8    9   10 
71.2 58.9 85.9 58.9 68.7 81.1 58.9 50.0 50.0 81.1 </code></pre>
<pre class="r"><code>hist(rpart_fit)</code></pre>
<p><img src="Prediction_practical_files/figure-html/unnamed-chunk-20-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="random-forests" class="section level4">
<h4>Random Forests</h4>
<ol start="10" style="list-style-type: decimal">
<li>Verwende <code>train()</code> um einen Random Forest namens <code>abschluss_rf</code> zu fitten, welcher die <code>Abschlussrate</code> als Funktion aller anderen im Datensatz enthaltenen Features vorhersagt. D.h.,…</li>
</ol>
<ul>
<li>setze das <code>form</code> Argument auf <code>Abschlussrate ~ .</code>.</li>
<li>setze das <code>data</code> Argument auf <code>graduation_train</code>.</li>
<li>setze das <code>method</code> Argument auf <code>method = &quot;rf&quot;</code>.</li>
<li>setze das <code>trControl</code> Argument auf <code>ctrl_none</code>.</li>
<li>setze das <code>tuneGrid</code> Argument auf <code>expand.grid(mtry = 2)</code>.</li>
</ul>
<pre class="r"><code>abschluss_rf &lt;- train(form = XX ~ .,   
                 data = XX,
                 method = &quot;XX&quot;,
                 trControl = XX,
                 tuneGrid = expand.grid(mtry = 2))  </code></pre>
<pre class="r"><code>abschluss_rf &lt;- train(form = Abschlussrate ~ .,   
                 data = graduation_train,
                 method = &quot;rf&quot;,
                 trControl = ctrl_none,
                 tuneGrid = expand.grid(mtry = 2))  </code></pre>
<ol start="11" style="list-style-type: decimal">
<li>Mittels <code>predict()</code> generiere die gefitteten Werte von <code>abschluss_rf</code> und speichere sie als <code>rf_fit</code> ab.</li>
</ol>
<pre class="r"><code># Speichere die gefitteten Werte
rf_fit &lt;- predict(XX)</code></pre>
<pre class="r"><code>rf_fit &lt;- predict(abschluss_rf)</code></pre>
<ol start="12" style="list-style-type: decimal">
<li>Printe <code>rf_fit</code> und kriere ein Histogramm der Werte mittels <code>hist()</code>. Sind die Werte in einer plausiblen Region?</li>
</ol>
<pre class="r"><code># Inspiziere die gefitteten Werte
XX
hist(XX)</code></pre>
<pre class="r"><code>rf_fit[1:10]</code></pre>
<pre><code>   1    2    3    4    5    6    7    8    9   10 
68.7 64.1 85.5 55.9 75.9 66.8 57.8 43.4 58.0 73.0 </code></pre>
<pre class="r"><code>hist(rf_fit)</code></pre>
<p><img src="Prediction_practical_files/figure-html/unnamed-chunk-26-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="beruteile-die-accuracy-im-fitting" class="section level4">
<h4>Beruteile die Accuracy im Fitting</h4>
<ol start="13" style="list-style-type: decimal">
<li>Speichere das Kriterium im <strong>Trainingsdatensatz</strong> (<code>graduation_train$Abschlussrate</code>) als eigenes Objekt mit dem Namen <code>criterion_train</code> ab.</li>
</ol>
<pre class="r"><code># Speichere die Kriteriumswerte im Training
criterion_train &lt;- XX$XX</code></pre>
<pre class="r"><code>criterion_train &lt;- graduation_train$Abschlussrate</code></pre>
<ol start="14" style="list-style-type: decimal">
<li>Verwende <code>postResample()</code> um die Fitting Performanz der drei Modelle zu vergleichen. Setze hierfür das <code>obs</code> Argument auf das eben erstellte <code>criterion_train</code> und das <code>pred</code> Argument auf die gefitteten Werte des jeweiligen Modells (z.B. <code>glm_fit</code>).</li>
</ol>
<pre class="r"><code># Regression
postResample(pred = XX, obs = XX)

# Decision Tree
postResample(pred = XX, obs = XX)

# Random Forest
postResample(pred = XX, obs = XX)</code></pre>
<pre class="r"><code># Regression
postResample(pred = glm_fit, obs = criterion_train)</code></pre>
<pre><code>    RMSE Rsquared      MAE 
  12.214    0.473    9.250 </code></pre>
<pre class="r"><code># Decision Trees
postResample(pred = rpart_fit, obs = criterion_train)</code></pre>
<pre><code>    RMSE Rsquared      MAE 
  12.072    0.486    9.536 </code></pre>
<pre class="r"><code># Random Forests
postResample(pred = rf_fit, obs = criterion_train)</code></pre>
<pre><code>    RMSE Rsquared      MAE 
   5.733    0.928    4.326 </code></pre>
<ol start="15" style="list-style-type: decimal">
<li>Welches Modell hat den besten Fit?</li>
</ol>
</div>
</div>
<div id="d---prediction-accuracy" class="section level3">
<h3>D - Prediction Accuracy</h3>
<ol style="list-style-type: decimal">
<li>Verwende <code>predict()</code> um für jedes Modell Vorhersagen für die Testdaten zu machen. Hierfür setzt du für das <code>newdata</code> Argument den gesamten Testdatensatz <code>graduation_test</code> ein. Speichere die Objekte als <code>glm_pred</code>, <code>rpart_pred</code> und <code>rf_pred</code>.</li>
</ol>
<pre class="r"><code># Regression
glm_pred &lt;- predict(XX, newdata = XX)

# Decision Trees
rpart_pred &lt;- predict(XX, newdata = XX)

# Random Forests
rf_pred &lt;- predict(XX, newdata = XX)</code></pre>
<pre class="r"><code># Regression
glm_pred &lt;- predict(abschluss_glm, newdata = graduation_test)

# Decision Tree
rpart_pred &lt;- predict(abschluss_rpart, newdata = graduation_test)

# Random Forest
rf_pred &lt;- predict(abschluss_rf, newdata = graduation_test)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Speichere das Kriterium im <strong>Testdatensatz</strong> (<code>graduation_test$Abschlussrate</code>) als eigenes Objekt mit dem Namen <code>criterion_test</code> ab.</li>
</ol>
<pre class="r"><code># Speichere die Kriteriumswerte des Testdatensatzes
criterion_test &lt;- XX$XX</code></pre>
<pre class="r"><code># Speichere die Kriteriumswerte des Testdatensatzes
criterion_test &lt;- graduation_test$Abschlussrate</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Verwende wiederum <code>postResample()</code> um nun die <em>Vorhersage</em> Performanz der drei Modelle zu vergleichen. Setze hierfür das <code>obs</code> Argument auf das eben erstellte <code>criterion_test</code> und das <code>pred</code> Argument auf die gefitteten Werte des jeweiligen Modells (z.B. <code>glm_pred</code>).</li>
</ol>
<pre class="r"><code># Regression
postResample(pred = XX, obs = XX)

# Decision Trees
postResample(pred = XX, obs = XX)

# Random Forests
postResample(pred = XX, obs = XX)</code></pre>
<pre class="r"><code># Regression
postResample(pred = glm_pred, obs = criterion_test)</code></pre>
<pre><code>    RMSE Rsquared      MAE 
  13.727    0.404    9.964 </code></pre>
<pre class="r"><code># Decision Trees
postResample(pred = rpart_pred, obs = criterion_test)</code></pre>
<pre><code>    RMSE Rsquared      MAE 
  14.741    0.321   11.104 </code></pre>
<pre class="r"><code># Random Forests
postResample(pred = rf_pred, obs = criterion_test)</code></pre>
<pre><code>    RMSE Rsquared      MAE 
  13.186    0.467    9.684 </code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Welches Modell zeigt die beste Vorhersageperformanz?</li>
</ol>
<pre class="r"><code># Der Random Forest!</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Vergleiche jeweils die Performanz der Modelle für Training und Test. In welchem Fall sind die Modelle schlechter? Welches Modell zeigt den grössten Unterschied?</li>
</ol>
<pre class="r"><code># Der Fit der Regression blieb relativ konstant. Die Performanz des Random
# hat deutlich abgenommen.</code></pre>
<br>
<p style="font-size:20px;background-color:#6ABA9A;color:white;padding-left:20px" align="left" width="100%">
Datensatz 2: <b>Hauspreise King County, Washington</b>
</p>
</div>
<div id="e---lade-die-house-datensatze" class="section level3">
<h3>E - Lade die <code>house</code> Datensätze</h3>
<ol style="list-style-type: decimal">
<li>Verwende die <code>read_csv()</code> Funktion um die Datensätze <code>house_train.csv</code> und <code>house_test.csv</code> einzulesen.</li>
</ol>
<pre class="r"><code># Lese Daten ein
house_train &lt;- read_csv(file = &quot;1_Data/house_train.csv&quot;)
house_test &lt;- read_csv(file = &quot;1_Data/house_test.csv&quot;)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><p>Printe die Datensätze.</p></li>
<li><p>Verwende <code>names(XX)</code>, <code>summary(XX)</code>, und <code>View()</code> um einen weiteren Überblick über die Daten zu bekommen.</p></li>
<li><p>Wiederum, führe den Code unten aus um sicherzustellen, dass alle <code>character</code> Features als Faktoren vorliegen.</p></li>
</ol>
<pre class="r"><code># Konvertiere alle character zu factor
house_train &lt;- house_train %&gt;%
          mutate_if(is.character, factor)

house_test &lt;- house_test %&gt;%
          mutate_if(is.character, factor)</code></pre>
</div>
<div id="f---modelliere-die-house-daten" class="section level3">
<h3>F - Modelliere die <code>house</code> Daten</h3>
<ol style="list-style-type: decimal">
<li>Fitte eine Regression, einen Decision Tree und einen Random Forest für <code>house_train.csv</code> wobei du <code>Preis</code> durch alle anderen Features im Datensatz vorherzusagen versuchst.</li>
</ol>
<pre class="r"><code># Regression
preis_glm &lt;- train(form = Preis ~ .,
                  data = house_train,
                  method = &quot;glm&quot;,
                  trControl = ctrl_none)

# Decision tree
preis_rpart &lt;- train(form = Preis ~ .,
                  data = house_train,
                  method = &quot;rpart&quot;,
                  trControl = ctrl_none,
                  tuneGrid = expand.grid(cp = .01)) 

# Random Forest
preis_rf &lt;- train(form = Preis ~ .,
                 data = house_train,
                 method = &quot;rf&quot;,
                 trControl = ctrl_none,
                 tuneGrid = expand.grid(mtry = 2))</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><p>Exploriere die Objekte indem du <code>XX$finalModel</code> inspizierst und <code>summary()</code> anwendest.</p></li>
<li><p>Verwende <code>predict()</code> um jeweils für die drei Modelle die vorhergesagten Werte separat für den Trainingsdatensatz und für den Testdatensatz zu generieren. Kreiere also drei Objekte mit Namen <code>XX_fit</code> und drei Objekte mit Namen <code>XX_pred</code>.</p></li>
</ol>
<pre class="r"><code># Gefittete Werte
glm_fit &lt;- predict(preis_glm)
rpart_fit &lt;- predict(preis_rpart)
rf_fit &lt;- predict(preis_rf)

# Vorhergesagte Werte
glm_pred &lt;- predict(preis_glm, newdata = house_test)
rpart_pred &lt;- predict(preis_rpart, newdata = house_test)
rf_pred &lt;- predict(preis_rf, newdata = house_test)</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Speichere die Kriteriumswerte im Trainings- und Testdatensatz separat als <code>criterion_train</code> und <code>criterion_test</code> ab.</li>
</ol>
<pre class="r"><code># Speichere die Kriteriumswerte
criterion_train &lt;- house_train$Preis
criterion_test &lt;- house_test$Preis</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Verwende <code>postResample()</code> um nun die <em>Fitting</em> und <em>Vorhersage</em> Performanz der drei Modelle zu vergleichen.</li>
</ol>
<pre class="r"><code># Fitting
postResample(pred = glm_fit, obs = criterion_train)</code></pre>
<pre><code>    RMSE Rsquared      MAE 
  651540       NA   536932 </code></pre>
<pre class="r"><code>postResample(pred = rpart_fit, obs = criterion_train)</code></pre>
<pre><code>    RMSE Rsquared      MAE 
  651540       NA   536932 </code></pre>
<pre class="r"><code>postResample(pred = rf_fit, obs = criterion_train)</code></pre>
<pre><code>    RMSE Rsquared      MAE 
  651540       NA   536932 </code></pre>
<pre class="r"><code># Prediction
postResample(pred = glm_pred, obs = criterion_test)</code></pre>
<pre><code>    RMSE Rsquared      MAE 
  631672       NA   524818 </code></pre>
<pre class="r"><code>postResample(pred = rpart_pred, obs = criterion_test)</code></pre>
<pre><code>    RMSE Rsquared      MAE 
  631671       NA   524817 </code></pre>
<pre class="r"><code>postResample(pred = rf_pred, obs = criterion_test)</code></pre>
<pre><code>    RMSE Rsquared      MAE 
  631672       NA   524818 </code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Welches Modell hat die beste Performanz im Fit? Welches in der Vorhersage? Welches zeigt den grössten Unterschied zwischen Fit und Vorhersage?</li>
</ol>
<pre class="r"><code># Random Forest!</code></pre>
<ol start="8" style="list-style-type: decimal">
<li>Welches Modell würdet ihr nun für den Einsatz in der Praxis empfehlen? Und welche Vorhersagegenauigkeit ist in der Realität zu erwarten?</li>
</ol>
</div>
<div id="x---challenges-model-tuning-parameter" class="section level3">
<h3>X - Challenges: Model Tuning Parameter</h3>
<ol style="list-style-type: decimal">
<li><p>In allen Decision Trees wurde bisher der Komplexitätsparameter <code>cp</code> auf <code>0.01</code> gesetzt. Probiere nun aus was passiert, wenn du etwas an ihm drehst. Setze ihn z.B. auf <code>0.2</code> und schaue dir dann an wie der Plot des Baums (<code>plot(as.party(XX_rpart$finalModel))</code>) sich verändert. Werden die Bäume komplizierter? Wie verändert sich Fit- und Vorhersageperformanz?</p></li>
<li><p>In allen Random Forests wurde bisher der Paramater <code>mtry</code> auf <code>2</code> gesetzt. Probiere nun aus was passiert, wenn du etwas an ihm drehst. Setze ihn z.B. auf <code>5</code> und beobachte wie sich Fit- und Vorhersageperformanz, sowie die Zeit, die für das Training des Modells beansprucht wird, verändern.</p></li>
</ol>
</div>
</div>
<div id="beispiele" class="section level2">
<h2>Beispiele</h2>
<pre class="r"><code># Schritt 0: Pakete laden -----------

library(tidyverse)    
library(caret)     
library(partykit)  
library(party)    

# Schritt 1: Daten laden, aufbereiten und explorieren ----------------------

# Trainingsdaten und Testdaten
data_train &lt;- read_csv(&quot;1_Data/mpg_train.csv&quot;)
data_test &lt;- read_csv(&quot;1_Data/mpg_test.csv&quot;)

# Konvertiere character zu factor
data_train &lt;- data_train %&gt;% mutate_if(is.character, factor)
data_test &lt;- data_test %&gt;% mutate_if(is.character, factor)

# Speichere das Kriterium in Training und Test
criterion_train &lt;- data_train$hwy
criterion_test &lt;- data_test$hwy

# Schritt 3: Trainiere Modelle: -----------------------------

# Regression 
hwy_glm &lt;- train(form = hwy ~ year + cyl + displ,
                 data = data_train,
                 method = &quot;glm&quot;,
                 trControl = trainControl(method = &quot;none&quot;))

# Inspiziere gefittete Regression
hwy_glm$finalModel
summary(hwy_glm)

# Decision Tree
hwy_rpart &lt;- train(form = hwy ~ year + cyl + displ,
                data = data_train,
                method = &quot;rpart&quot;,
                trControl = trainControl(method = &quot;none&quot;),
                tuneGrid = expand.grid(cp = .01))

# Inspiziere gefitteten Decision Tree
hwy_rpart$finalModel
plot(as.party(hwy_rpart$finalModel))

# Random Forests 
hwy_rf &lt;- train(form = hwy ~ year + cyl + displ,
                data = data_train,
                method = &quot;rf&quot;,
                trControl = trainControl(method = &quot;none&quot;),
                tuneGrid = expand.grid(mtry = 2))  

# Inspiziere gefitteten Random Forest
hwy_rf$finalModel


# Schritt 4: Evaluiere Fit: -----------------------------

# Speichere gefittete Werte
glm_fit &lt;- predict(hwy_glm)
rpart_fit &lt;- predict(hwy_rpart)
rf_fit &lt;- predict(hwy_rf)

# Evaluiere fit
postResample(pred = glm_fit, obs = criterion_train)
postResample(pred = rpart_fit, obs = criterion_train)
postResample(pred = rf_fit, obs = criterion_train)

# Schritt 5: Evaluiere Vorhersage: -----------------------------

# Speichere vorhergesagte Werte
glm_pred &lt;- predict(hwy_glm, newdata = data_test)
rpart_pred &lt;- predict(hwy_rpart, newdata = data_test)
rf_pred &lt;- predict(hwy_rf, newdata = data_test)

# Evaluiere fit
postResample(pred = glm_pred, obs = criterion_test)
postResample(pred = rpart_pred, obs = criterion_test)
postResample(pred = rf_pred, obs = criterion_test)</code></pre>
</div>
<div id="datensatze" class="section level2">
<h2>Datensätze</h2>
<table>
<thead>
<tr class="header">
<th align="left">Datei</th>
<th align="left">Zeilen</th>
<th align="left">Spalten</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><a href="https://raw.githubusercontent.com/therbootcamp/ML_2020Apr/master/1_Data/graduation_train.csv">graduation_train.csv</a></td>
<td align="left">500</td>
<td align="left">18</td>
</tr>
<tr class="even">
<td align="left"><a href="https://raw.githubusercontent.com/therbootcamp/ML_2020Apr/master/1_Data/graduation_test.csv">graduation_test.csv</a></td>
<td align="left">277</td>
<td align="left">18</td>
</tr>
<tr class="odd">
<td align="left"><a href="https://raw.githubusercontent.com/therbootcamp/ML_2020Apr/master/1_Data/house_train.csv">house_train.csv</a></td>
<td align="left">5000</td>
<td align="left">21</td>
</tr>
<tr class="even">
<td align="left"><a href="https://raw.githubusercontent.com/therbootcamp/ML_2020Apr/master/1_Data/house_test.csv">house_test.csv</a></td>
<td align="left">1000</td>
<td align="left">21</td>
</tr>
</tbody>
</table>
<div id="graduation_train-und-graduation_test" class="section level4">
<h4><code>graduation_train</code> und <code>graduation_test</code></h4>
<p>Die <code>graduation_train</code> und <code>graduation_test</code> Datensätze entstammen dem <code>College</code> Datensatz aus dem <code>ISLR</code> Paket. sie enthalten Statistiken für eine grosse Anzahl US Colleges auf Basis des <em>US News and World Reports</em> aus dem Jahr 1995.</p>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Privatuniversitaet</td>
<td align="left">Ja oder Nein</td>
</tr>
<tr class="even">
<td align="left">Bewerbungen</td>
<td align="left">Anzahl Bewerbungen</td>
</tr>
<tr class="odd">
<td align="left">Angenommen</td>
<td align="left">Anzahl angenommene Bewerbungen</td>
</tr>
<tr class="even">
<td align="left">Eingeschrieben</td>
<td align="left">Anzahl eingeschrieben</td>
</tr>
<tr class="odd">
<td align="left">Prozent_Top10</td>
<td align="left">Prozent der Studierenden innerhalb Top 10% in High School</td>
</tr>
<tr class="even">
<td align="left">Prozent_Top25</td>
<td align="left">Prozent der Studierenden innerhalb Top 25% in High School</td>
</tr>
<tr class="odd">
<td align="left">Vollzeit</td>
<td align="left">Anzahl Studierende in Vollzeit</td>
</tr>
<tr class="even">
<td align="left">Teilzeit</td>
<td align="left">Anzahl Studierende in Teilzeit</td>
</tr>
<tr class="odd">
<td align="left">Kosten_ausserhalb</td>
<td align="left">Kosten für Studierende aus einem anderen Staat</td>
</tr>
<tr class="even">
<td align="left">Kosten_Unterkunft</td>
<td align="left">Kosten für Studierende für Unterkunft und Verpflegung</td>
</tr>
<tr class="odd">
<td align="left">Kosten_Buecher</td>
<td align="left">Kosten für Studierende für Bücher</td>
</tr>
<tr class="even">
<td align="left">Kosten_persoenlich</td>
<td align="left">Kosten für Studierende für Persönliches</td>
</tr>
<tr class="odd">
<td align="left">Prozent_PhD</td>
<td align="left">Anteil PhDs innerhalb der Dozentenschaft</td>
</tr>
<tr class="even">
<td align="left">Prozent_Degree</td>
<td align="left">Anteil Abschlüsse innerhalb der Dozentenschaft</td>
</tr>
<tr class="odd">
<td align="left">Verhaeltnis_Stud.Doz.</td>
<td align="left">Verhältnis Studierene zu Dozenten</td>
</tr>
<tr class="even">
<td align="left">Prozent_Spenden</td>
<td align="left">Anteil Alumnis, die an das College spenden</td>
</tr>
<tr class="odd">
<td align="left">Kosten_Student</td>
<td align="left">Ausbildungskosten für das College pro Student</td>
</tr>
<tr class="even">
<td align="left">Abschlussrate</td>
<td align="left">Abschlussrate</td>
</tr>
</tbody>
</table>
</div>
<div id="house_train-and-house_test" class="section level4">
<h4><code>house_train</code> and <code>house_test</code></h4>
<p>Die <code>house_train</code> und <code>house_test</code> Datensätze enthalten Hauspreise und -Eigenschaften in der King County in den USA, welches die Stadt Seattle beinhaltet. Quelle der Daten ist <a href="https://www.kaggle.com/harlfoxem/housesalesprediction">Kaggle</a>.</p>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Preis</td>
<td align="left">Preis des Hauses</td>
</tr>
<tr class="even">
<td align="left">Schlafzimmer</td>
<td align="left">Anzahl Schlafzimmer</td>
</tr>
<tr class="odd">
<td align="left">Baeder</td>
<td align="left">Anzahl Bäder</td>
</tr>
<tr class="even">
<td align="left">Gesamt_sqft</td>
<td align="left">Gesamtfläche des Hauses in square foot</td>
</tr>
<tr class="odd">
<td align="left">Grundstück_sqft</td>
<td align="left">Fläche des Grundstücks in square foot</td>
</tr>
<tr class="even">
<td align="left">Stockwerke</td>
<td align="left">Anzahl Stockwerke</td>
</tr>
<tr class="odd">
<td align="left">Uferlage</td>
<td align="left">0 = Nein, 1 = Ja</td>
</tr>
<tr class="even">
<td align="left">Besichtigung</td>
<td align="left">Wurde das Haus besichtigt</td>
</tr>
<tr class="odd">
<td align="left">Zustand</td>
<td align="left">Wie gut ist der Zustand des Hauses</td>
</tr>
<tr class="even">
<td align="left">Einstufung</td>
<td align="left">Einstufung gemäss King County Einstufungssystem</td>
</tr>
<tr class="odd">
<td align="left">Wohnraum_sqft</td>
<td align="left">Wohnraum des Hauses in square foot</td>
</tr>
<tr class="even">
<td align="left">Keller_sqft</td>
<td align="left">Kellerraum des Hauses in square foot</td>
</tr>
<tr class="odd">
<td align="left">Baujahr</td>
<td align="left">Baujahr</td>
</tr>
<tr class="even">
<td align="left">Renovationsjahr</td>
<td align="left">Renovationsjahr</td>
</tr>
<tr class="odd">
<td align="left">Postleitzahl</td>
<td align="left">Postleitzahl</td>
</tr>
<tr class="even">
<td align="left">Breitengrad</td>
<td align="left">Breitengrad</td>
</tr>
<tr class="odd">
<td align="left">Laengengrad</td>
<td align="left">Längengrad</td>
</tr>
<tr class="even">
<td align="left">Gesamt_sqft_2015</td>
<td align="left">Gesamtfläche des Hauses in square foot in 2015</td>
</tr>
<tr class="odd">
<td align="left">Grundstück_sqft_2015</td>
<td align="left">Fläche des Grundstücks in square foot in 2015</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="funktionen" class="section level2">
<h2>Funktionen</h2>
<div id="pakete" class="section level3">
<h3>Pakete</h3>
<table>
<thead>
<tr class="header">
<th align="left">Paket</th>
<th align="left">Installation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>tidyverse</code></td>
<td align="left"><code>install.packages(&quot;tidyverse&quot;)</code></td>
</tr>
<tr class="even">
<td align="left"><code>caret</code></td>
<td align="left"><code>install.packages(&quot;caret&quot;)</code></td>
</tr>
<tr class="odd">
<td align="left"><code>partykit</code></td>
<td align="left"><code>install.packages(&quot;partykit&quot;)</code></td>
</tr>
<tr class="even">
<td align="left"><code>party</code></td>
<td align="left"><code>install.packages(&quot;party&quot;)</code></td>
</tr>
</tbody>
</table>
</div>
<div id="funktionen-1" class="section level3">
<h3>Funktionen</h3>
<table>
<thead>
<tr class="header">
<th align="left">Funktion</th>
<th align="left">Paket</th>
<th align="left">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>trainControl()</code></td>
<td align="left"><code>caret</code></td>
<td align="left">Definiere wie das Modell trainiert wird</td>
</tr>
<tr class="even">
<td align="left"><code>train()</code></td>
<td align="left"><code>caret</code></td>
<td align="left">Trainiere (fitte) ein Modell</td>
</tr>
<tr class="odd">
<td align="left"><code>predict(object, newdata)</code></td>
<td align="left"><code>stats</code></td>
<td align="left">Vorhersage des Kriteriumswerts in <code>newdata</code></td>
</tr>
<tr class="even">
<td align="left"><code>postResample()</code></td>
<td align="left"><code>caret</code></td>
<td align="left">Evaluiere Performanz in Regressionsfällen</td>
</tr>
<tr class="odd">
<td align="left"><code>confusionMatrix()</code></td>
<td align="left"><code>caret</code></td>
<td align="left">Evaluiere Performanz in Klassifikationsfällen</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="materialien" class="section level2">
<h2>Materialien</h2>
<div id="cheatsheet" class="section level3">
<h3>Cheatsheet</h3>
<figure>
<center>
<a href="https://github.com/rstudio/cheatsheets/raw/master/caret.pdf"> <img src="https://www.rstudio.com/wp-content/uploads/2015/01/caret-cheatsheet.png" alt="Trulli" style="width:70%"></a><br> <font style="font-size:10px"> from <a href= "https://github.com/rstudio/cheatsheets/raw/master/caret.pdf</figcaption">github.com/rstudio</a></font>
</figure>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
